const questions67 = [
    {
        question: "La diarrh√©e motrice est caus√©e par :",
        answers: [
            {"text": "Diab√®te", "correct": true},
            {"text": "Tumeur villeuse du rectum", "correct": false},
            {"text": "Polype du colon droit", "correct": false},
            {"text": "Rectocolite h√©morragique", "correct": false},
            {"text": "Maladie c≈ìliaque", "correct": false}
        ]
    },
    {
        question: "En faveur d'une diarrh√©e par malabsorption :",
        answers: [
            {"text": "Diarrh√©e hydrique", "correct": false},
            {"text": "Diarrh√©e glaireuse", "correct": false},
            {"text": "Xylos√©mie a 0,340 g/l a la 24√©me heure", "correct": false},
            {"text": "Poids des selles √† 60O g/j", "correct": false},
            {"text": "St√©atorrh√©e √† 3 g/j", "correct": true}
        ]
    },
    {
        question: "Au cours d'une diarrh√©e chronique par syndrome de malabsorption, on ne retrouve pas :",
        answers: [
          {"text": "≈íd√®me des membres inf√©rieurs", "correct": false},
          {"text": "Crise de t√©tanie", "correct": false},
          {"text": "Spl√©nom√©galie", "correct": true},
          {"text": "Phan√®res cassants", "correct": false},
          {"text": "H√©matomes au moindre choc", "correct": false}
        ]
    },
    {
        question: "Image(s) √©vocatrice(s) de la pancr√©atite chronique :",
        answers: [
            {"text": "Retentissement sur le tube digestif a l'echographie abdominale", "correct": false},
            {"text": "Calcifications pr√©vert√©brales au niveau de L1 L2 sur les clich√©s sans pr√©paration", "correct": true},
            {"text": "Amputations vasculaires sur l'art√©riographie coeliaque s√©lective", "correct": false},
            {"text": "Hypertrophie pancr√©atique √† la tomodensitom√©trie", "correct": false},
            {"text": "Reflux du produit de contraste dans le canal de Wirsung sur la cholangiographie veineuse", "correct": false}
        ]
    },
    {
        question: "Les complications suivantes sont en rapport avec une pancr√©atite chronique, sauf :",
        answers: [
            {"text": "Ict√®re", "correct": false},
            {"text": "Epanchement pleural", "correct": false},
            {"text": "Pseudokyste pancr√©atique", "correct": false},
            {"text": "St√©nose duod√©nale", "correct": false},
            {"text": "Ulc√®re gastrique", "correct": true}
        ]
    },
    {
        question: "Au cours d'une pancr√©atite chronique calcifiante, l'insuffisance pancr√©atique exocrine peut entrainer toutes les manifestations suivantes sauf :",
        answers: [
            {"text": "Une st√©atorrh√©e", "correct": false},
            {"text": "Une malabsorption de la vitamine B12", "correct": false},
            {"text": "Une cr√©atorrh√©e", "correct": false},
            {"text": "Une malabsorption des vitamines liposolubles", "correct": false},
            {"text": "une ob√©sit√©", "correct": true}
        ]
    },
    {
        question: "Une pancr√©atite chronique peut se traduire par les sympt√¥mes suivants sauf :",
        answers: [
            {"text": "Un syndrome douloureux solaire", "correct": false},
            {"text": "Des vomissements en rapport avec une st√©nose duod√©nale", "correct": false},
            {"text": "Un ict√®re h√©molytique", "correct": true},
            {"text": "Une tum√©faction √©pigastrique", "correct": false},
            {"text": "Une hypertention portale segmentaire", "correct": false}
        ]
    },
    {
        question: "Concernant la pancr√©atite chronique, on ne retrouve pas :",
        answers: [
            {"text": "La cause la plus fr√©quente est l'alcoolisme chronique", "correct": false},
            {"text": "Les douleurs peuvent √™tre calm√©es par l'aspirine", "correct": true},
            {"text": "L'amaigrissement est habituel", "correct": false},
            {"text": "La st√©atorrh√©e appara√Æt tardivement", "correct": false},
            {"text": "Le diab√®te survient pr√©cocement, d√©s le d√©but de l'affection", "correct": false}
        ]
    },
    {
        question: "Etiologie(s) la ou les plus fr√©quente(s) de pancr√©atite aigu√´ en Alg√©rie :",
        answers: [
          {"text": "Lithiase biliaire", "correct": true},
          {"text": "Alcool", "correct": false},
          {"text": "Ob√©sit√©", "correct": false},
          {"text": "Toxique", "correct": false},
          {"text": "Une ascaridiose de la voie biliaire principale", "correct": false}
        ]
    },
    {
        question: "La pancr√©atite aigu√´ se caract√©rise par les donn√©es suivantes, sauf :",
        answers: [
            {"text": "Peut √™tre observ√©e chez l'√©thylique", "correct": false},
            {"text": "Peut √™tre diagnostiqu√©e gr√¢ce √† l'√©l√©vation de la lipase", "correct": false},
            {"text": "L'hypocalc√©mie est un signe de gravit√©", "correct": false},
            {"text": "Peut √™tre en rapport avec l'enclavement d'un calcul au niveau de l'ampoule de Vater", "correct": false},
            {"text": "Une contracture abdominale est un signe clinique d'appel", "correct": true}
        ]
    },
    {
        question: "Une crise de pancr√©atite aigu√´ est √©voqu√©e particuli√®rement devant :",
        answers: [
          {"text": "une irradiation p√©ri ombilicale en barre", "correct": false},
          {"text": "une irradiation Sous-costale droite", "correct": false},
          {"text": "une irradiation Scapulaire droite", "correct": false},
          {"text": "une irradiation Transfixiante vers le dos", "correct": true},
          {"text": "une irradiation Descendante", "correct": false}
        ]
    },
    {
        question: "Dans une pancr√©atite aigu√´ h√©morragique, sont de mauvais pronostic les anomalies suivantes sauf :",
        answers: [
            {"text": "El√©vation de la cr√©atinin√©mie", "correct": false},
            {"text": "Baisse de la calc√©mie", "correct": false},
            {"text": "Hyperleucocytose > 16000/mm3", "correct": false},
            {"text": "Hyperamylas√©mie", "correct": true},
            {"text": "Hyperglyc√©mie", "correct": false}
        ]
    },
    {
        question: "Concernant la pancr√©atite aigu√´ :",
        answers: [
            {"text": "El√©vation de l'amylas√©mie est le signe le plus sp√©cifique", "correct": false},
            {"text": "El√©vation de la lipas√©mie est plus sp√©cifique et plus durable que celle de l'amylas√©mie", "correct": true},
            {"text": "El√©vation de l'amylas√©mie porte sp√©cifiquement sur l'isoamylase pancr√©atique, ce qui permet d'√©carter d'autres diagnostics", "correct": false},
            {"text": "El√©vation tr√®s importante de l'amylas√©mie est plus souvent observ√©e lorsqu'il s'agit d'une pancr√©atite d'origine alcoolique", "correct": false},
            {"text": "Toutes ces propositions sont justes", "correct": false}
        ]
    },
    {
        question: "Les signes cliniques suivants orientent vers une pancr√©atite aigu√´ s√©v√®re sauf :",
         answers: [
            {"text": "Vomissements incoercibles", "correct": true},
            {"text": "Contracture √©pigastrique", "correct": false},
            {"text": "Choc hypovol√©mique", "correct": false},
            {"text": "Emp√¢tement profond p√©riombilical", "correct": false},
            {"text": "T√¢che(s) bleue(s) des flancs (signe de Grey-Turner)", "correct": false}
        ]
    },
    {
        question: "Examen(s) morphologique(s) permettant d'appr√©cier la n√©crose pancr√©atique au cours d'une pancr√©atite aigu√´ grave :",
        answers: [
            {"text": "Cholangiographie r√©trograde", "correct": false},
            {"text": "Art√©riographie coelio-m√©sent√©rique", "correct": false},
            {"text": "Echographie", "correct": false},
            {"text": "Tomodensitom√©trie", "correct": true},
            {"text": "Scintigraphie au Tc 99", "correct": false}
        ]
    }
];


document.addEventListener('DOMContentLoaded', () => {
    const quiz67 = new QuizGame('quiz-container-67', questions67);
});

class QuizGame {
    constructor(containerId, questions) {
        this.container = document.getElementById(containerId);
        this.questions = questions;
        
        this.bestScoreDisplay = this.container.querySelector('.best-score-value');
        this.resetBestScoreBtn = this.container.querySelector('.reset-best-score-btn');
        this.startButton = this.container.querySelector('.start-btn');
        this.nextButton = this.container.querySelector('.next-btn');
        this.restartButton = this.container.querySelector('.restart-btn');
        this.startScreen = this.container.querySelector('.start-screen');
        this.quizContainer = this.container.querySelector('.quiz-container');
        this.resultsScreen = this.container.querySelector('.results-screen');
        this.questionElement = this.container.querySelector('.question');
        this.answerButtonsElement = this.container.querySelector('.answer-buttons');
        this.scoreTextElement = this.container.querySelector('.score-text');
        

        this.currentQuestionIndex = 0;
        this.score = 0;
        this.bestScore = localStorage.getItem(`bestScore_${containerId}`) ? 
                         parseInt(localStorage.getItem(`bestScore_${containerId}`)) : 0;
        
        this.init();
    }
    
    init() {

        this.updateBestScoreDisplay();
        

        this.startButton.addEventListener('click', () => this.startQuiz());
        this.nextButton.addEventListener('click', () => {
            this.currentQuestionIndex++;
            this.setNextQuestion();
        });
        this.restartButton.addEventListener('click', () => this.restartQuiz());
        this.resetBestScoreBtn.addEventListener('click', () => this.resetBestScore());
    }
    
    updateBestScoreDisplay() {
        this.bestScoreDisplay.textContent = ((this.bestScore / this.questions.length) * 100).toFixed(1);
    }
    
    startQuiz() {
        this.startScreen.classList.add('hide');
        this.quizContainer.classList.remove('hide');
        this.currentQuestionIndex = 0;
        this.score = 0;
        this.setNextQuestion();
    }
    
    setNextQuestion() {
        this.resetState();
        if (this.currentQuestionIndex < this.questions.length) {
            this.showQuestion(this.questions[this.currentQuestionIndex]);
        } else {
            this.showResults();
        }
    }
    
        showQuestion(question) {
            this.resetState();
            this.questionElement.innerText = question.question;
            
            const shuffledAnswers = this.shuffleArray([...question.answers]);
            
            shuffledAnswers.forEach(answer => {
                const button = document.createElement('button');
                button.innerText = answer.text;
                button.classList.add('btn', 'answer-btn');
                if (answer.correct) {
                    button.dataset.correct = answer.correct;
                }
                button.addEventListener('click', (e) => this.selectAnswer(e));
                this.answerButtonsElement.appendChild(button);
            });
        }
    
        shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    
    resetState() {
        this.nextButton.classList.add('hide');
        while (this.answerButtonsElement.firstChild) {
            this.answerButtonsElement.removeChild(this.answerButtonsElement.firstChild);
        }
    }
    
    selectAnswer(e) {
        const selectedButton = e.target;
        const correct = selectedButton.dataset.correct === 'true';
        
        selectedButton.classList.add('selected');
        
         Array.from(this.answerButtonsElement.children).forEach(button => {
           button.disabled = true;
            
        if (button === selectedButton) {
            if (correct) {
                button.classList.add('correct');
            } else {
                button.classList.add('incorrect'); 
            }
        }
         });
        
        if (correct) {
            this.score++;
        }
        
        if (this.questions.length > this.currentQuestionIndex + 1) {
            this.nextButton.classList.remove('hide');
        } else {
            setTimeout(() => {
                this.showResults();
            }, 1500);
        }
    }
    
    showResults() {
        this.quizContainer.classList.add('hide');
        this.resultsScreen.classList.remove('hide');
        
        const percentage = (this.score / this.questions.length) * 100;
        let comment = "";
        
        if (percentage >= 80) {
            comment = "Tr√®s bien! Vous avez bien maitris√© cette le√ßon. R√©direction dans 5 secondes";   
            setTimeout(() => {
                window.location.href = "../../fin.html";
            }, 5000);

        }else if (percentage >= 65 && percentage < 80) {
            comment = "Vous avez r√©ussi, mais la note minimale requise est de 80 √† plus."; 

        } else {
            comment = "Dommage! Peut-√™tre devriez-vous r√©viser un peu.";
        }
        
        let newRecord = false;
        if (this.score > this.bestScore) {
            this.bestScore = this.score;
            localStorage.setItem(`bestScore_${this.container.id}`, this.bestScore);
            newRecord = true;
        }
        
        this.updateBestScoreDisplay();
        
        this.scoreTextElement.innerHTML = `
            <p>Votre score: <strong>${percentage.toFixed(1)}%</strong></p>
            <p>Meilleur score: <strong>${((this.bestScore / this.questions.length) * 100).toFixed(1)}%</strong></p>
            <p>${comment} ${newRecord ? "üèÜ Nouveau record!" : ""}</p>
        `;
    }
    
    restartQuiz() {
        this.resultsScreen.classList.add('hide');
        this.startQuiz();
    }

    // resetBestScore() {
    //     if (confirm("√ätes-vous s√ªr de vouloir r√©initialiser votre meilleur score ?")) {
    //         this.bestScore = 0;
    //         localStorage.setItem(`bestScore_${this.container.id}`, this.bestScore);
    //         this.updateBestScoreDisplay();
    //             alert("Meilleur score r√©initialis√© !");
    //     }
    // }
}

